<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel = "stylesheet" type="text/css" href="main.css"/>
<title>Target</title>
</head>

<body>
<div id="zombie_map">
	<script>
		var zombie_map;
		
		var old_position;
    	var tolerance = 10;
		var data = `48.1662745 21.2034017 box.png
					48.1670609 21.2033531 box.png
					48.1673904 21.2040029 box.png
					`;
		
		var markers = data.split("\n");
		var all_markers = [];


		function initMap() {
				zombie_map = new google.maps.Map(document.getElementById('zombie_map'), {
				zoom: 17,
				center: {lat: 48.163195, lng: 21.199560}
			});
			
			navigator.options = {
				enableHighAccuracy: true,
				maximumAge: 3000,
				timeout: 2000
			};
			
			// Get geolocation
			if (navigator.geolocation) {
				navigator.options;
				navigator.geolocation.watchPosition(set_my_position);
			}
			else {
				alert("Nem támogatott böngésző. :/");
			}
			
			for(var i=0; i < markers.length; i++){
				var marker_data = markers[i].trim().split(" ");
				var marker_position = new google.maps.LatLng(marker_data[0], marker_data[1]);
				
				var marker = new google.maps.Marker({
					position: marker_position,
					icon: marker_data[2],
					map: zombie_map
				});
				all_markers.push(marker);
			}
			
			console.log(all_markers);
			
			old_position = new google.maps.Marker({
				position: {lat: 0, lng: 0},
				map: zombie_map
			})
		}
		
		function set_my_position(position){
			old_position.setMap(null);
			var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			var marker = new google.maps.Marker({
			  position: pos,
			  icon: "santa.png",
			  map: zombie_map
			});
			old_position = marker;
			for(var i=0; i < all_markers.length; i++){
				var distance = google.maps.geometry.spherical.computeDistanceBetween(pos, all_markers[i].getPosition());
				
				if( distance < tolerance ){
					var what_is_it = all_markers[i].getPosition();
					
					alert("Found the " + what_is_it );
					
					all_markers[i].setMap(null);
					
				}
				
			}
    	}
				
	</script>
</div>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCfFoEZ_mt40jPX5eHQuSKSqWNL4EFsIzg&callback=initMap&libraries=geometry">
</script>
</body>
</html>
