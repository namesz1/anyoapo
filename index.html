<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel = "stylesheet" type="text/css" href="main.css"/>
<title>Target</title>
</head>

<body>
<div id="zombie_map">
	<script>
		var zombie_map;
		
		var old_position;
    	var tolerance = 10;
		var data = `48.16324253664344 21.19980660549343 gun.png
					48.162468920346015 21.20294286861571 gun.png
					48.16600504633428 21.201060510674875 gun.png
					48.16888519983746 21.200757197764766 target.png
					`;
		
		var markers = data.split("\n");
		var all_markers = [];


		function initMap() {
				zombie_map = new google.maps.Map(document.getElementById('zombie_map'), {
				zoom: 17,
				center: {lat: 48.163195, lng: 21.199560}
			});
			
			// Get geolocation
			if( navigator.geolocation) {
				navigator.geolocation.watchPosition(set_my_position);
			}
			else {
				alert("Nem támogatott böngésző. :/");
			}
			
			for(var i=0; i < markers.length; i++){
				var marker_data = markers[i].trim().split(" ");
				var marker_position = new google.maps.LatLng(marker_data[0], marker_data[1]);
				
				var marker = new google.maps.Marker({
					position: marker_position,
					icon: marker_data[2],
					map: zombie_map
				});
				all_markers.push(marker);
			}
			
			console.log(all_markers);
			
			old_position = new google.maps.Marker({
				position: {lat: 0, lng: 0},
				map: zombie_map
			})
		}
		
		function set_my_position(position){
			old_position.setMap(null);
			var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			var marker = new google.maps.Marker({
			  position: pos,
			  icon: "soldier.png",
			  map: zombie_map
			});
			old_position = marker;
			for(var i=0; i < all_markers.length; i++){
				var distance = google.maps.geometry.spherical.computeDistanceBetween(pos, all_markers[i].getPosition());
				if( distance < tolerance ){
					var what_is_it = all_markers[i].getPosition();
					if (what_is_it ="48.16600504633428, 21.201060510674875"){
						alert("Réka pince\n\n Ez egy nagyon komoly hely!");
					}
				}
			}
    	}
				
	</script>
</div>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCfFoEZ_mt40jPX5eHQuSKSqWNL4EFsIzg&callback=initMap&libraries=geometry">
</script>
</body>
</html>
